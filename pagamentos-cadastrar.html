<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/img/ifood-logo.svg" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">

    <title>Pagamentos</title>
</head>
<body>
    <!-- Cabeçalho -->
    <header class="px-4 d-flex align-items-center">
        <div class="flex-grow-1">
            <img src="./img/ifood-logo.svg" alt="Logo do iFood" class="logo-ifood ms-5">
        </div>
        
        <div class="d-flex gap-4">
            <img src="./img/bell.svg" alt="Ícone de Notificação" class="pointer">
            <img src="./img/mensagem.svg" alt="Ícone de Mensagem" class="pointer">
            <a href="perfil.html">
                <img src="/img/perfil.svg" alt="Ícone de Perfil" class="pointer">
            </a>
        </div>
    </header>
    
    <div class="d-flex">
        <!-- Navegação -->
        <div class="w-25 d-flex navegacao flex-column">
            <div class="w-100 d-flex justify-content-center align-items-center" style="height: 200px;">
                <img src="./img/brabo-logo.png" alt="Logo da Brabo" class="rounded-circle h-50">
            </div>

            <nav class="d-flex justify-content-center align-items-center">
                <ul class="nav nav-pills d-flex flex-column gap-3">
                    <li class="nav-item dropdown d-flex">
                        <img src="./img/dashboard.svg" alt="Ícone de Casa" class="mx-3">
                        <a class="link-nav dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" href="#">Dashboard</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="dashboard-entrada.html">Entradas</a></li>
                            <li><a class="dropdown-item" href="dashboard-saidas.html">Saídas</a></li>
                        </ul>
                    </li>
                    <li class="nav-item d-flex">
                        <img src="./img/produtos.svg" alt="Ícone de Casa" class="mx-3">
                        <a class="link-nav dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" href="#">Produtos</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="produtos-cadastrar.html">Cadastrar</a></li>
                            <li><a class="dropdown-item" href="produtos-lista.html">Lista</a></li>
                        </ul>
                    </li>
                    <li class="nav-item d-flex">
                        <img src="./img/fornecedores.svg" alt="Ícone de Casa" class="mx-3">
                        <a class="link-nav dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" href="#">Fornecedores</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="fornecedores-cadastrar.html">Cadastrar</a></li>
                            <li><a class="dropdown-item" href="fornecedores-lista.html">Lista</a></li>
                        </ul>
                    </li>
                    <li class="nav-item d-flex">
                        <img src="./img/funcionarios.svg" alt="Ícone de Casa" class="mx-3">
                        <a class="link-nav dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" href="#">Funcionários</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="funcionarios-cadastrar.html">Cadastrar</a></li>
                            <li><a class="dropdown-item" href="funcionarios-lista.html">Lista</a></li>
                        </ul>
                    </li>
                    <li class="nav-item d-flex">
                        <img src="./img/pagamentos.svg" alt="Ícone de Casa" class="mx-3">
                        <a class="link-nav-active dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" href="#">Pagamentos</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="pagamentos-cadastrar.html">Cadastrar</a></li>
                            <li><a class="dropdown-item" href="pagamentos-lista.html">Lista</a></li>
                        </ul>
                    </li>
                    <li class="nav-item d-flex">
                        <img src="./img/vendas.svg" alt="Ícone de Casa" class="mx-3">
                        <a class="link-nav dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" href="#">Vendas</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="vendas-cadastrar.html">Cadastrar</a></li>
                            <li><a class="dropdown-item" href="vendas-lista.html">Lista</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>

        <!-- Form -->
        <div class="w-100 container p-3">
            <h2 id="cadastrar-id" class="mt-3 ms-2">Cadastrar Pagamento: 1</h2>

            <form class="d-flex flex-column mt-4 w-90">
                <div class="d-flex">
                    <div class="d-flex flex-column w-50">
                        <label for="nome" class="ms-1">Nome:</label>
                        <input id="nome" name="nome" type="text" class="rounded-3 w-100" />
                    </div>

                    <div class="d-flex flex-column w-50">
                        <label class="ms-4">Tipo:</label>
                        <div class="d-flex align-items-center">
                            <input id="fornecedor" name="tipo" type="radio" class="ms-4 me-2" value="Fornecedor" checked /><label for="fornecedor">Fornecedor</label>
                        </div>
                        <div class="d-flex align-items-center">
                            <input id="funcionario" name="tipo" type="radio" class="ms-4 me-2" value="Funcionário"><label for="funcionario">Funcionário</label>
                        </div>
                    </div>
                </div>

                <label for="nota" class="ms-1 mt-4">Nota Fiscal:</label>
                <input id="nota" name="nota" type="text" class="rounded-3 w-100" />

                <label for="desc" class="ms-1 mt-4">Descrição:</label>
                <textarea id="desc" name="desc" rows="3" class="rounded-3 w-100"></textarea>

                <label for="valor" class="ms-1 mt-4">Valor:</label>
                <input id="valor" name="valor" type="text" onkeydown="mascararValor(event)" class="rounded-3 w-100" />

                <input id="cadastrar-pagto" type="submit" class="rounded-3 mt-4" value="Cadastrar" />
            </form>
        </div>
    </div>

    <script type="text/javascript">
    let id;

    window.addEventListener("load", function () {
        let idJSON = JSON.parse(localStorage.getItem('pagamentos'));
        id = idJSON ? Object.keys(idJSON).length + 1 : 1;

        document.getElementById('cadastrar-id').innerText = "Cadastrar Pagamento: " + id;
    });

    let valor = '';
    function mascararValor(event) {
        event.preventDefault();

        if(event.key == 'Backspace' && valor != '') {
            valor = valor.slice(0, -1); 
        }
        else if(event.key.match(/[0-9]/g)) {
            valor += event.key; 
        }

        if (valor != '') {
            let pontos = valor.length > 2?Math.floor((valor.length - 3) / 3):0;

            let currency = valor.split("");
            currency = currency.reverse();
            currency = currency.join("");

            currency = currency.padEnd(3, '0');
            currency = currency.substring(0, 2) + ',' + currency.substring(2, currency.length);

            currency = currency.split("");
            currency = currency.reverse();
            currency = currency.join("");

            currency = currency.replace('.','');

            for(var i = 0; i < pontos; i++) {
                var resto = (currency.length - 3 - i) % 3;
                resto = resto == 0 ? 3 : resto;

                currency = currency.substring(0, resto + (3 * i) + i) + '.' + currency.substring(resto + (3 * i) + i, currency.length);
            }

            event.target.value = 'R$ ' + currency;
        }
        else {
            event.target.value = valor;
        }
    }

    function handleSubmit(event) {
        event.preventDefault();

        const data = new FormData(event.target);

        var date = new Date();
        var dataAtual = date.getDate().toString().padStart(2, '0') + '/' + (date.getMonth() + 1).toString().padStart(2, '0') + '/' + date.getFullYear();

        let value = Object.fromEntries(data.entries());
        let lista = JSON.parse(localStorage.getItem('pagamentos'));
        let newEntry = {};
        newEntry[id] = { nome: value.nome, nota: value.nota, desc: value.desc, data: dataAtual, valor: value.valor };
        value = Object.assign({}, lista, newEntry);

        localStorage.setItem("pagamentos", JSON.stringify(value));

        location.reload();
    }

    const form = document.querySelector('form');
    form.addEventListener('submit', handleSubmit);
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>